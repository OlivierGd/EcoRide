(()=>{(()=>{document.addEventListener("DOMContentLoaded",()=>{let o=document.getElementById("searchDate");o&&!o.value&&(o.value=u());let a=document.getElementById("formSearchDestination");a&&a.addEventListener("submit",t=>{let e=document.getElementById("searchStartCity").value.trim(),i=document.getElementById("searchEndCity").value.trim(),n=document.getElementById("searchDate").value;if(!e&&!i&&!n){t.preventDefault(),alert("Veuillez remplir au moins un champ (ville de d\xE9part, destination ou date).");return}if(n){let r=new Date(n),s=new Date;if(s.setHours(0,0,0,0),r<s){t.preventDefault(),alert("La date ne peut-\xEAtre dans le pass\xE9");return}}}),l("searchStartCity","startCitySuggestions"),l("searchEndCity","endCitySuggestions")});function u(){let o=new Date,a=o.getFullYear(),t=String(o.getMonth()+1).padStart(2,"0"),e=String(o.getDate()).padStart(2,"0");return`${a}-${t}-${e}`}function l(o,a){let t=document.getElementById(o),e=document.getElementById(a);if(!t||!e){console.error(`\xC9l\xE9ments non trouv\xE9s: ${o} ou ${a}`);return}let i;t.addEventListener("input",()=>{let n=t.value.trim();if(clearTimeout(i),n.length<2){e.style.display="none",e.innerHTML="";return}i=setTimeout(async()=>{try{let r=await fetch(`https://geo.api.gouv.fr/communes?nom=${encodeURIComponent(n)}&fields=nom,codeDepartement&boost=population&limit=8`);if(!r.ok)throw new Error("Erreur r\xE9seau");let s=await r.json();if(e.innerHTML="",s.length===0){e.style.display="none";return}s.forEach(c=>{let d=document.createElement("div");d.className="suggestion-item",d.textContent=`${c.nom} (${c.codeDepartement})`,d.addEventListener("click",()=>{t.value=c.nom,e.style.display="none",e.innerHTML=""}),e.appendChild(d)}),e.style.display="block"}catch(r){console.error("Erreur lors de l'autocompl\xE9tion :",r),e.style.display="none"}},300)}),document.addEventListener("click",n=>{!t.contains(n.target)&&!e.contains(n.target)&&(e.style.display="none")}),t.addEventListener("keydown",n=>{n.key==="Escape"&&(e.style.display="none")})}})();})();
