(()=>{(()=>{document.addEventListener("DOMContentLoaded",()=>{let a=document.getElementById("searchDate");a&&!a.value&&(a.value=m());let r=document.getElementById("formSearchDestination");r&&r.addEventListener("submit",t=>{let e=document.getElementById("searchStartCity").value.trim(),i=document.getElementById("searchEndCity").value.trim(),n=document.getElementById("searchDate").value;if(!e&&!i&&!n){t.preventDefault(),alert("Veuillez remplir au moins un champ (ville de d\xE9part, destination ou date).");return}if(n){let o=new Date(n),l=new Date;if(l.setHours(0,0,0,0),o<l){t.preventDefault(),alert("La date ne peut-\xEAtre dans le pass\xE9");return}}}),u("searchStartCity","startCitySuggestions"),u("searchEndCity","endCitySuggestions")});function m(){let a=new Date,r=a.getFullYear(),t=String(a.getMonth()+1).padStart(2,"0"),e=String(a.getDate()).padStart(2,"0");return`${r}-${t}-${e}`}function u(a,r){let t=document.getElementById(a),e=document.getElementById(r);if(!t||!e){console.error(`\xC9l\xE9ments non trouv\xE9s: ${a} ou ${r}`);return}let i;t.addEventListener("input",()=>{let n=t.value.trim();if(clearTimeout(i),n.length<2){e.style.display="none",e.innerHTML="";return}i=setTimeout(async()=>{try{let o=await fetch(`https://geo.api.gouv.fr/communes?nom=${encodeURIComponent(n)}&fields=nom,codeDepartement&boost=population&limit=8`);if(!o.ok)throw new Error("Erreur r\xE9seau");let l=await o.json();if(e.innerHTML="",l.length===0){e.style.display="none";return}l.forEach(d=>{let s=document.createElement("div");s.className="suggestion-item",s.textContent=`${d.nom} (${d.codeDepartement})`,s.addEventListener("click",()=>{t.value=d.nom,e.style.display="none",e.innerHTML=""}),e.appendChild(s)}),e.style.display="block"}catch(o){console.error("Erreur lors de l'autocompl\xE9tion :",o),e.style.display="none"}},300)}),document.addEventListener("click",n=>{!t.contains(n.target)&&!e.contains(n.target)&&(e.style.display="none")}),t.addEventListener("keydown",n=>{n.key==="Escape"&&(e.style.display="none")})}})();})();
